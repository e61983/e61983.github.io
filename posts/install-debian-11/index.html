<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>使用 Debian 來架設工作站 - Yuan のノート</title><meta name=description content="心之所至，隨意亂書"><meta name=keywords content="golang,embedded,linux,backend,programming"><meta name=author content="Yuan"><meta property="og:title" content="使用 Debian 來架設工作站 - Yuan のノート"><meta property="og:description" content="心之所至，隨意亂書"><meta property="og:type" content="article"><meta property="og:url" content="https://e61983.github.io/posts/install-debian-11/"><link rel=icon type=image/svg+xml href=/favicon.svg><link rel=icon type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/favicon.svg><meta name=theme-color content="#0d1117"><link rel=stylesheet href=https://e61983.github.io/yuan/css/main.min.css><link rel=stylesheet href=https://e61983.github.io/yuan/css/chroma.min.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Inter:wght@300;400;500;600;700&display=swap" rel=stylesheet></head><body class=theme-dark><div class=layout><header class=header><div class=container><div class=header-content><div class=header-brand><a href=https://e61983.github.io/ class=brand-link><span class=brand-text>Yuan のノート</span></a><p class=brand-subtitle>心之所至，隨意亂書</p></div><nav class=nav><ul class=nav-list><li class=nav-item><a href=/ class=nav-link>首頁</a></li><li class=nav-item><a href=/posts/ class=nav-link>文章</a></li><li class=nav-item><a href=/categories/ class=nav-link>分類</a></li><li class=nav-item><a href=/tags/ class=nav-link>標籤</a></li><li class=nav-item><a href=/archive/ class=nav-link>歸檔</a></li></ul></nav><button class=mobile-menu-toggle aria-label="Toggle menu">
<span class=hamburger></span>
<span class=hamburger></span>
<span class=hamburger></span></button></div></div></header><main class=main><div class=container><div class=post-layout><article class=post><header class=post-header><h1 class=post-title>使用 Debian 來架設工作站</h1><div class=post-meta><time class=post-date datetime=2021-08-31T22:56:03+08:00>2021年08月31日
</time><span class=reading-time>2 分鐘閱讀</span>
<span class=word-count>361 字</span>
<span class=post-author>by Yuan</span></div><div class=post-tags><a href=/tags/linux class=tag>linux</a>
<a href=/tags/debian class=tag>debian</a>
<a href=/tags/server class=tag>server</a></div><div class=post-categories><a href=/categories/mis class=category>mis</a></div></header><div class=mobile-toc-toggle><button class=toc-toggle-btn aria-label=顯示/隱藏目錄>
<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9h14V7H3v2zm0 4h14v-2H3v2zm0 4h14v-2H3v2zm16 0h2v-2h-2v2zm0-10v2h2V7h-2zm0 6h2v-2h-2v2z"/></svg>
目錄</button><nav class=mobile-toc><h3 class=toc-title>目錄</h3><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#主要內容>主要內容</a><ul><li><a href=#下載映像檔>下載映像檔</a></li><li><a href=#製作安裝碟>製作安裝碟</a></li><li><a href=#安裝>安裝</a></li><li><a href=#設定-ip>設定 IP</a></li><li><a href=#安裝系統更新與常用工具>安裝系統更新與常用工具</a></li><li><a href=#設定時間同步>設定時間同步</a></li><li><a href=#設定防火牆規則>設定防火牆規則</a></li><li><a href=#修改-ssh-server-設定並上傳遠端存取公鑰>修改 SSH Server 設定並上傳遠端存取公鑰</a></li><li><a href=#自動安裝更新>自動安裝更新</a></li><li><a href=#logrotate>logrotate</a></li></ul></li><li><a href=#小結>小結</a></li><li><a href=#參考連結>參考連結</a></li></ul></nav></nav></div><div class=post-content><h2 id=前言>前言</h2><p>最近剛好在重新安裝工作站，就順手記錄起來囉!</p><h2 id=主要內容>主要內容</h2><h3 id=下載映像檔>下載映像檔</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>wget https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-11.0.0-amd64-netinst.iso
</span></span></code></pre></div><h3 id=製作安裝碟>製作安裝碟</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>sudo dd <span class=k>if</span><span class=o>=</span>debian-11.0.0-amd64-netinst.iso <span class=nv>of</span><span class=o>=</span>/dev/DISK <span class=nv>bs</span><span class=o>=</span>10M
</span></span></code></pre></div><h3 id=安裝>安裝</h3><p>安裝步驟可以參考<a href="https://www.server-world.info/query?os=Debian_11&amp;p=install">這邊</a>。</p><h3 id=設定-ip>設定 IP</h3><h4 id=使用-systemd-networkd-設定-ip>使用 systemd-networkd 設定 IP</h4><p>透過重新命名 <code>/etc/network/interfaces</code> 的方式，來停用原本的網路介面配置。並建立 <code>systemd-networkd</code> 的設定檔。
完成後，我們就可以啟用 systemd-networkd 了。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln> 1</span><span class=cl><span class=c1># 取消 IPv6</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=nb>echo</span> <span class=s2>&#34;net.ipv6.conf.all.disable_ipv6 = 1&#34;</span> &gt;&gt; /etc/sysctl.conf
</span></span><span class=line><span class=ln> 3</span><span class=cl>
</span></span><span class=line><span class=ln> 4</span><span class=cl>mv /etc/network/interfaces<span class=o>{</span>,.save<span class=o>}</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>
</span></span><span class=line><span class=ln> 6</span><span class=cl>cat <span class=s>&lt;&lt; EOF &gt;&gt; /etc/systemd/network/lan.network
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=s>[Match]
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=s>Name=eth0
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=s>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=s>[Network]
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=s>Address=192.168.0.2/24
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=s>Gateway=192.168.0.254
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=s>DNS=8.8.8.8
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>
</span></span><span class=line><span class=ln>16</span><span class=cl>systemctl <span class=nb>enable</span> systemd-networkd
</span></span><span class=line><span class=ln>17</span><span class=cl>systemctl start systemd-networkd
</span></span></code></pre></div><h4 id=ip-已改用-systemd-networkd>IP (已改用 systemd-networkd)</h4><p>修改 /etc/network/interfaces 來設定主機的 IP</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=ln>1</span><span class=cl>allow-hotplug eth0
</span></span><span class=line><span class=ln>2</span><span class=cl>iface eth0 inet static
</span></span><span class=line><span class=ln>3</span><span class=cl>        address 192.168.0.2/24
</span></span><span class=line><span class=ln>4</span><span class=cl>        gateway 192.168.0.254
</span></span><span class=line><span class=ln>5</span><span class=cl>        # dns-* options are implemented by the resolvconf package, if installed
</span></span><span class=line><span class=ln>6</span><span class=cl>        dns-nameservers 8.8.8.8
</span></span><span class=line><span class=ln>7</span><span class=cl>        dns-search happy.internal
</span></span></code></pre></div><p>使用下列指令來重新起動網路</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>/etc/init.d/networking restart
</span></span></code></pre></div><div class="notice notice-info" style="border-left:4px solid;padding:1rem;margin:1rem 0;border-radius:0 4px 4px 0;border-left-color:#3498db;background-color:#e8f4fd;color:#2c3e50"><div style=font-weight:700;margin-bottom:.5rem>ℹ️
動態從 DHCP 取得 IP</div><div><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=ln>1</span><span class=cl>auto eth0
</span></span><span class=line><span class=ln>2</span><span class=cl>allow-hotplug eth0
</span></span><span class=line><span class=ln>3</span><span class=cl>iface eth0 inet dhcp
</span></span></code></pre></div><p>我們可以使用下列指令來進行臨時的設定</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>ip addr add 192.168.0.2/24 dev eth0
</span></span><span class=line><span class=ln>2</span><span class=cl>ip addr del  192.168.0.2/24 dev eth0
</span></span><span class=line><span class=ln>3</span><span class=cl>
</span></span><span class=line><span class=ln>4</span><span class=cl>dhcp eth0
</span></span><span class=line><span class=ln>5</span><span class=cl>dhcp -r eth0
</span></span><span class=line><span class=ln>6</span><span class=cl>
</span></span><span class=line><span class=ln>7</span><span class=cl>ip link <span class=nb>set</span> eth0 up
</span></span><span class=line><span class=ln>8</span><span class=cl>ip link <span class=nb>set</span> eth0 down
</span></span></code></pre></div></div></div><h3 id=安裝系統更新與常用工具>安裝系統更新與常用工具</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>apt upgrade
</span></span><span class=line><span class=ln>2</span><span class=cl>apt update
</span></span><span class=line><span class=ln>3</span><span class=cl>apt install -y aptitude
</span></span><span class=line><span class=ln>4</span><span class=cl>aptitude install -y silversearcher-ag vim htop
</span></span></code></pre></div><h3 id=設定時間同步>設定時間同步</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>cat <span class=s>&lt;&lt; EOF &gt; /etc/systemd/timesyncd.conf
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=s>[Time]
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=s>NTP=time.google.com clock.stdtime.gov.tw
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>
</span></span><span class=line><span class=ln>6</span><span class=cl>systemctl restart systemd-timesyncd.service
</span></span><span class=line><span class=ln>7</span><span class=cl>timedatectl status
</span></span><span class=line><span class=ln>8</span><span class=cl>date
</span></span></code></pre></div><h3 id=設定防火牆規則>設定防火牆規則</h3><h4 id=firewalld>Firewalld</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=ln>1</span><span class=cl><span class=n>aptitude</span> <span class=n>install</span> <span class=o>-</span><span class=n>y</span> <span class=n>firewalld</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=n>firewall</span><span class=o>-</span><span class=n>cmd</span> <span class=o>--</span><span class=n>add</span><span class=o>-</span><span class=n>port</span><span class=o>=</span><span class=mi>22022</span><span class=o>/</span><span class=n>tcp</span> <span class=o>--</span><span class=n>permanent</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=n>firewall</span><span class=o>-</span><span class=n>cmd</span> <span class=o>--</span><span class=n>reload</span>
</span></span><span class=line><span class=ln>4</span><span class=cl><span class=n>firewall</span><span class=o>-</span><span class=n>cmd</span> <span class=o>--</span><span class=n>list</span><span class=o>-</span><span class=n>all</span>
</span></span></code></pre></div><div class="notice notice-info" style="border-left:4px solid;padding:1rem;margin:1rem 0;border-radius:0 4px 4px 0;border-left-color:#3498db;background-color:#e8f4fd;color:#2c3e50"><div><p>如果想直接操作 nftables 的話，可以使用下列指令</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>systemctl <span class=nb>enable</span> nftables
</span></span><span class=line><span class=ln>2</span><span class=cl>systemctl start nftables
</span></span><span class=line><span class=ln>3</span><span class=cl>nft add rule inet filter input tcp dport <span class=m>22</span> accept
</span></span><span class=line><span class=ln>4</span><span class=cl>nft list ruleset
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=c1>#nft list table inet filter</span>
</span></span></code></pre></div></div></div><h4 id=ufw-已改用-firewalld>ufw (已改用 firewalld)</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>ufw <span class=nb>enable</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>ufw default deny
</span></span><span class=line><span class=ln>3</span><span class=cl>ufw allow from XXX.XXX.XXX.XXX to XXX.XXX.XXX.XXX port <span class=m>2234</span> proto tcp
</span></span></code></pre></div><h3 id=修改-ssh-server-設定並上傳遠端存取公鑰>修改 SSH Server 設定並上傳遠端存取公鑰</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>sed -i <span class=s1>&#39;s/^Port.*$/Port 2234/g&#39;</span> /etc/ssh/sshd_config
</span></span><span class=line><span class=ln>2</span><span class=cl>systemctl restart ssh
</span></span><span class=line><span class=ln>3</span><span class=cl>ssh-copy -i ~/.ssh/id_rsa  XXX.XXX.XXX.XXX -p <span class=m>2234</span> -l user
</span></span></code></pre></div><div class="notice notice-info" style="border-left:4px solid;padding:1rem;margin:1rem 0;border-radius:0 4px 4px 0;border-left-color:#3498db;background-color:#e8f4fd;color:#2c3e50"><div style=font-weight:700;margin-bottom:.5rem>ℹ️
產生新的金錀</div><div><p>如果想要生成新的金鑰，可以輸入下列指令</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>ssh-keygen -t rsa -b <span class=m>4096</span> -f ~/.ssh/new_key_rsa -C email@example.com
</span></span></code></pre></div></div></div><h4 id=限定只能使用金鑰進行認證>限定只能使用金鑰進行認證</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>sed -i <span class=s1>&#39;s/^UsePAM.*$/UsePAM no/g&#39;</span> /etc/ssh/sshd_config
</span></span><span class=line><span class=ln>2</span><span class=cl>sed -i <span class=s1>&#39;s/^PermitRootLogin.*$/PermitRootLogin no/g&#39;</span> /etc/ssh/sshd_config
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=nb>echo</span> <span class=s1>&#39;PasswordAuthentication no&#39;</span> &gt;&gt; /etc/ssh/sshd_config
</span></span><span class=line><span class=ln>4</span><span class=cl>systemctl restart ssh
</span></span></code></pre></div><div class="notice notice-info" style="border-left:4px solid;padding:1rem;margin:1rem 0;border-radius:0 4px 4px 0;border-left-color:#3498db;background-color:#e8f4fd;color:#2c3e50"><div><p>如果是使用 sudo 的話，可以使用 tee 將輸出導向檔案</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=nb>echo</span> <span class=s1>&#39;PasswordAuthentication no&#39;</span> <span class=p>|</span> sudo tee -a /etc/ssh/sshd_config
</span></span></code></pre></div><p>查看有誰登入失敗以及有誰登入成功</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>cat /var/log/auth.log <span class=p>|</span> ag <span class=s1>&#39;sshd.*Invalid&#39;</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>cat /var/log/auth.log <span class=p>|</span> ag <span class=s1>&#39;sshd.*opened&#39;</span>
</span></span></code></pre></div></div></div><h4 id=擋掉登入失敗次數過多的連線>擋掉登入失敗次數過多的連線</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>aptitude install -y fail2ban
</span></span><span class=line><span class=ln>2</span><span class=cl>sed -e <span class=s1>&#39;s/^enabled = false$/enabled = true/g&#39;</span> /etc/fail2ban/jail.conf &gt; /etc/fail2ban/jail.local
</span></span><span class=line><span class=ln>3</span><span class=cl>systemctl <span class=nb>enable</span> fail2ban
</span></span></code></pre></div><div class="notice notice-info" style="border-left:4px solid;padding:1rem;margin:1rem 0;border-radius:0 4px 4px 0;border-left-color:#3498db;background-color:#e8f4fd;color:#2c3e50"><div><p>我們可以使用 fail2ban-client 來查看目前的運行狀況</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>fail2ban-client status
</span></span></code></pre></div></div></div><h3 id=自動安裝更新>自動安裝更新</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>aptitude install -y unattended-upgrades
</span></span><span class=line><span class=ln>2</span><span class=cl>dpkg-reconfigure -plow unattended-upgrades
</span></span><span class=line><span class=ln>3</span><span class=cl>systemctl status unattended-upgrades.service
</span></span></code></pre></div><h3 id=logrotate>logrotate</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>/etc/logrotate.conf
</span></span></code></pre></div><h2 id=小結>小結</h2><p>本文記錄了系統在剛安裝完成時，要先進行的配置。如: IP、時間、防火牆等。
未來若有再新增設定，會再補充說明。</p><h2 id=參考連結>參考連結</h2><ul><li><a href=https://www.debian.org>Debian 官方網站</a></li><li><a href=https://wiki.debian.org/SystemdNetworkd>systemd-networkd</a></li><li><a href=https://computingforgeeks.com/how-to-install-and-configure-firewalld-on-debian/>How to install and configure firewalld on debian</a></li></ul></div><footer class=post-footer><div class=post-nav><a href=https://e61983.github.io/posts/gps-module/ class=post-nav-prev><span class=nav-label>上一篇</span>
<span class=nav-title>NEO M8N GPS模組</span>
</a><a href=https://e61983.github.io/posts/yocto-with-imx8qxp/ class=post-nav-next><span class=nav-label>下一篇</span>
<span class=nav-title>在 i.MX 8QuadXPlus 上使用 Yocto 建置 Linux 系統</span></a></div></footer></article><aside class=post-sidebar><nav class="toc desktop-toc"><h3 class=toc-title>目錄</h3><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#主要內容>主要內容</a><ul><li><a href=#下載映像檔>下載映像檔</a></li><li><a href=#製作安裝碟>製作安裝碟</a></li><li><a href=#安裝>安裝</a></li><li><a href=#設定-ip>設定 IP</a></li><li><a href=#安裝系統更新與常用工具>安裝系統更新與常用工具</a></li><li><a href=#設定時間同步>設定時間同步</a></li><li><a href=#設定防火牆規則>設定防火牆規則</a></li><li><a href=#修改-ssh-server-設定並上傳遠端存取公鑰>修改 SSH Server 設定並上傳遠端存取公鑰</a></li><li><a href=#自動安裝更新>自動安裝更新</a></li><li><a href=#logrotate>logrotate</a></li></ul></li><li><a href=#小結>小結</a></li><li><a href=#參考連結>參考連結</a></li></ul></nav></nav></aside></div></div><button id=backToTop class=back-to-top aria-label=回到頂部>
<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg></button></main><footer class=footer><div class=container><div class=footer-content><div class=social-links><a href=https://github.com/e61983 target=_blank rel=noopener class=social-link><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg>
GitHub</a></div><div class=copyright><p>&copy; 2025 Yuan. All rights reserved.</p><p>Powered by <a href=https://gohugo.io target=_blank rel=noopener>Hugo</a> & Yuan Theme</p></div></div></div></footer></div><script src=https://e61983.github.io/yuan/js/main.min.js></script></body></html>