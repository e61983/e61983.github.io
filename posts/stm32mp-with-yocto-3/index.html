<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>在 STM32MP1 上使用 Yocto 建置 Linux 系統 3 - Yuan のノート</title><meta name=description content="心之所至，隨意亂書"><meta name=keywords content="golang,embedded,linux,backend,programming"><meta name=author content="Yuan"><meta property="og:title" content="在 STM32MP1 上使用 Yocto 建置 Linux 系統 3 - Yuan のノート"><meta property="og:description" content="心之所至，隨意亂書"><meta property="og:type" content="article"><meta property="og:url" content="https://e61983.github.io/posts/stm32mp-with-yocto-3/"><link rel=icon type=image/svg+xml href=/favicon.svg><link rel=icon type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/favicon.svg><meta name=theme-color content="#0d1117"><link rel=stylesheet href=https://e61983.github.io/yuan/css/main.min.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Inter:wght@300;400;500;600;700&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css></head><body class=theme-dark><div class=layout><header class=header><div class=container><div class=header-content><div class=header-brand><a href=https://e61983.github.io/ class=brand-link><span class=brand-text>Yuan のノート</span></a><p class=brand-subtitle>心之所至，隨意亂書</p></div><nav class=nav><ul class=nav-list><li class=nav-item><a href=/ class=nav-link>首頁</a></li><li class=nav-item><a href=/posts/ class=nav-link>文章</a></li><li class=nav-item><a href=/categories/ class=nav-link>分類</a></li><li class=nav-item><a href=/tags/ class=nav-link>標籤</a></li><li class=nav-item><a href=/archive/ class=nav-link>歸檔</a></li></ul></nav><button class=mobile-menu-toggle aria-label="Toggle menu">
<span class=hamburger></span>
<span class=hamburger></span>
<span class=hamburger></span></button></div></div></header><main class=main><div class=container><div class=post-layout><article class=post><header class=post-header><h1 class=post-title>在 STM32MP1 上使用 Yocto 建置 Linux 系統 3</h1><div class=post-meta><time class=post-date datetime=2021-08-12T13:23:59+08:00>2021年08月12日
</time><span class=reading-time>3 分鐘閱讀</span>
<span class=word-count>479 字</span>
<span class=post-author>by Yuan</span></div><div class=post-tags><a href=/tags/stm32mp1 class=tag>stm32mp1</a>
<a href=/tags/yocto class=tag>yocto</a>
<a href=/tags/linux class=tag>linux</a></div><div class=post-categories><a href=/categories/embedded-system class=category>embedded system</a></div></header><div class=mobile-toc-toggle><button class=toc-toggle-btn aria-label=顯示/隱藏目錄>
<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9h14V7H3v2zm0 4h14v-2H3v2zm0 4h14v-2H3v2zm16 0h2v-2h-2v2zm0-10v2h2V7h-2zm0 6h2v-2h-2v2z"/></svg>
目錄</button><nav class=mobile-toc><h3 class=toc-title>目錄</h3><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#主要內容>主要內容</a><ul><li><a href=#bsp-layer>BSP Layer</a></li><li><a href=#machine-常見的配置項>Machine 常見的配置項</a></li><li><a href=#bootloader-常見的配置項>Bootloader 常見的配置項</a></li><li><a href=#kernel-常見的配置項>Kernel 常見的配置項</a></li><li><a href=#kernel-metadata-常見的配置項>Kernel Metadata 常見的配置項</a></li><li><a href=#建立-bootlinlabs-machine>建立 bootlinlabs Machine</a></li><li><a href=#distro-layer>Distro Layer</a></li></ul></li><li><a href=#小結>小結</a></li><li><a href=#參考連結>參考連結</a></li></ul></nav></nav></div><div class=post-content><h2 id=前言>前言</h2><p>繼先前建立好基楚的系統後，我們已經加入了 meta-bootlinlabs Layer。
本文會接續之前建立的環境，開始加入自訂的 Machine。</p><h2 id=主要內容>主要內容</h2><h3 id=bsp-layer>BSP Layer</h3><p>BSP Layer 是 Layer 的一種，它通常會包含目標機器的硬體配置、Bootloader、Kernel、Display Support。常以 <code>meta-&lt;bsp-name></code> 命名，裡面會有 machnes 資料夾。</p><p>如果我們想知道該 BSP Layer 它支援了哪些機器，我們可以在該 Layer 中，觀察它的 conf/machine/*.conf。
目標機器的配置檔會以 <code>MACHINE.conf</code> 命名。</p><p>但更好的方式是，該 BSP Layer 有完善的 README，讓我們可以直接參考。</p><h3 id=machine-常見的配置項>Machine 常見的配置項</h3><ul><li>TARGET_ARCH
該機器的硬體架構，例: arm, aarch64</li><li>PREFERRED_PROVIDER_virtual/kernel
預設使用的 Kernel</li><li>MACHINE_FEATURES
提供的硬體特性清單，例: usbgadget, usbhost, screen, wifi, bluetooth</li><li>SERIAL_CONSOLES
要使用的序列埠與通訊速度，它會被傳給Kernel 做為 console 的參數。例: 115200;ttyS0</li><li>KERNEL_IMAGETYPE
要編譯的映像檔種類，例: zImage, uImage</li></ul><h3 id=bootloader-常見的配置項>Bootloader 常見的配置項</h3><ul><li>SPL_BINARY
如果有 SPL (Secondary Program Loader)，指定此 SPL 的名稱。預設是空字串。</li><li>UBOOT_SUFFIX
UBOOT的後綴，例: img。預設是 bin。</li><li>UBOOT_MACHINE
目前機器所使用的配置檔。</li><li>UBOOT_ENTRYPOINT
Bootloader 的進入點。例: 0xC0800000</li><li>UBOOT_LOADADDRESS
Bootloader 載入位置。</li><li>UBOOT_MAKE_TARGET
Makefile 的目標，預設是 all</li></ul><h3 id=kernel-常見的配置項>Kernel 常見的配置項</h3><p>Kernel 的配置也會撰寫在 <code>&lt;machine>.conf</code> 中</p><ul><li>PREFERRED_PROVIDER_virtual/kernel
指定要使用的 Kerenl Package</li><li>PREFERRED_VERSION_linux-yocto = &ldquo;5.10%&rdquo;
指定要使用的版本</li><li>SRC_URL
必須提供 Kernel 配置檔，並命名為 defconfig。<pre tabindex=0><code>SRC_URL += &#34;file://defconfig		\
			file://nand-support.cfg	\
			file://ethernet-support.cfg \
			&#34; 	
</code></pre></li></ul><h3 id=kernel-metadata-常見的配置項>Kernel Metadata 常見的配置項</h3><ul><li>LINUX_KERNEL_TYPE<ul><li>standard (預設)</li><li>tiny</li><li>preempt-rt</li></ul></li><li>KERNEL_FEATURES
提供的 Kernel 特性清單</li></ul><p>資料夾結構</p><ul><li>bsp/</li><li>cfg/</li><li>features/
例: features/smp.scc
KERNEL_FEATURES += &ldquo;features/smp.scc&rdquo;<div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-txt data-lang=txt><span style=display:flex><span> define KFEATURE_DESCRIPTION &#34;Enable SMP&#34;
</span></span><span style=display:flex><span> kconf hardware smp.cfg
</span></span><span style=display:flex><span> patch smp-support.patch
</span></span></code></pre></td></tr></table></div></div></li><li>ktypes/</li><li>patches/</li></ul><h4 id=調整-kernel-配置>調整 Kernel 配置</h4><p>調整 Kernel 配置時，我們可以以提供 defconfig 的方式進行。或是提供 Configure Fragments 進行調整。</p><ul><li>提供 defconfig<div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># 配置 Kernel</span>
</span></span><span style=display:flex><span>bitbake -c kernel_configme linux-yocto
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># 手動調整 Kernel 選項</span>
</span></span><span style=display:flex><span>bitbake -c menuconfig linux-yocto
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># 產生 .config</span>
</span></span><span style=display:flex><span>bitbake -c savedefconfig  linux-yocto
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># 我們再自行將 .confg 存為 defconfig</span>
</span></span></code></pre></td></tr></table></div></div></li><li>提供 Configure Fragments<div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># 配置 Kernel</span>
</span></span><span style=display:flex><span>bitbake -c kernel_configme linux-yocto
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># 手動調整 Kernel 選項</span>
</span></span><span style=display:flex><span>bitbake -c menuconfig linux-yocto
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># 產生 Configure Fragments</span>
</span></span><span style=display:flex><span>bitbake -c diffconfig linux-yocto
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># 確認 Configure Fragments 是否有正確被套用</span>
</span></span><span style=display:flex><span>bitbake -c kernel_configcheck -f linux-yocto
</span></span></code></pre></td></tr></table></div></div></li></ul><h3 id=建立-bootlinlabs-machine>建立 bootlinlabs Machine</h3><p>我們可以參考 meta-st-stm32mp/conf/machine 的配置進行 bootlinlabs Machine 的建立。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>pushd ../meta-bootlinlabs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># 建立 machine 資料夾</span>
</span></span><span style=display:flex><span>mkdir conf/machine
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># 建立 bootlinlabs 配置檔</span>
</span></span><span style=display:flex><span>echo <span style=color:#a5d6ff>&#39;require conf/machine/include/st-machine-common-stm32mp.inc&#39;</span> &gt;&gt; conf/machine/bootlinlabs.conf
</span></span><span style=display:flex><span>echo <span style=color:#a5d6ff>&#39;require conf/machine/include/st-machine-providers-stm32mp.inc&#39;</span> &gt;&gt; conf/machine/bootlinlabs.conf
</span></span><span style=display:flex><span>echo <span style=color:#a5d6ff>&#39;&#39;</span> &gt;&gt; conf/machine/bootlinlabs.conf
</span></span><span style=display:flex><span>echo <span style=color:#a5d6ff>&#39;DEFAULTTUNE = &#34;cortexa7thf-neon-vfpv4&#34;&#39;</span> &gt;&gt; conf/machine/bootlinlabs.conf
</span></span><span style=display:flex><span>echo <span style=color:#a5d6ff>&#39;require conf/machine/include/tune-cortexa7.inc&#39;</span> &gt;&gt; conf/machine/bootlinlabs.conf
</span></span><span style=display:flex><span>echo <span style=color:#a5d6ff>&#39;&#39;</span> &gt;&gt; conf/machine/bootlinlabs.conf
</span></span><span style=display:flex><span>echo <span style=color:#a5d6ff>&#39;BOOTSCHEME_LABELS += &#34;trusted&#34;&#39;</span> &gt;&gt; conf/machine/bootlinlabs.conf
</span></span><span style=display:flex><span>echo <span style=color:#a5d6ff>&#39;STM32MP_DT_FILES_DK += &#34;stm32mp157f-dk2&#34;&#39;</span> &gt;&gt; conf/machine/bootlinlabs.conf
</span></span><span style=display:flex><span>echo <span style=color:#a5d6ff>&#39;FLASHLAYOUT_CONFIG_LABELS += &#34;sdcard&#34;&#39;</span> &gt;&gt; conf/machine/bootlinlabs.conf
</span></span><span style=display:flex><span>popd
</span></span></code></pre></td></tr></table></div></div><p>修改 conf/local.conf 內的 MACHINE，並重新編譯。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sed -i <span style=color:#a5d6ff>&#39;s/^MACHINE.*/MACHINE ?= &#34;bootlinlabs&#34;/g&#39;</span> conf/local.conf
</span></span><span style=display:flex><span>bitbake core-image-minimal
</span></span></code></pre></td></tr></table></div></div><p>我們可以在 <code>${BUILDDIR}/tmp/deploy/images/**bootlinlabs**/</code> 看到我們所建立的新 Machine。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-txt data-lang=txt><span style=display:flex><span>$ ls tmp/deploy/images/bootlinlabs/
</span></span><span style=display:flex><span>arm-trusted-firmware
</span></span><span style=display:flex><span>bootloader
</span></span><span style=display:flex><span>core-image-minimal-bootlinlabs-20210812144202_nand_4_256_multivolume.rootfs.ubi
</span></span><span style=display:flex><span>core-image-minimal-bootlinlabs-20210812144202_nand_4_256_multivolume.ubinize.cfg.ubi
</span></span><span style=display:flex><span>core-image-minimal-bootlinlabs-20210812144202_nand_4_256.rootfs.ubi
</span></span><span style=display:flex><span>core-image-minimal-bootlinlabs-20210812144202_nand_4_256.rootfs.ubifs
</span></span><span style=display:flex><span>core-image-minimal-bootlinlabs-20210812144202_nand_4_256.ubinize.cfg.ubi
</span></span><span style=display:flex><span>core-image-minimal-bootlinlabs-20210812144202.rootfs.ext4
</span></span><span style=display:flex><span>core-image-minimal-bootlinlabs-20210812144202.rootfs.manifest
</span></span><span style=display:flex><span>core-image-minimal-bootlinlabs-20210812144202.rootfs.tar.xz
</span></span><span style=display:flex><span>core-image-minimal-bootlinlabs-20210812144202.testdata.json
</span></span><span style=display:flex><span>core-image-minimal-bootlinlabs.ext4
</span></span><span style=display:flex><span>core-image-minimal-bootlinlabs.manifest
</span></span><span style=display:flex><span>core-image-minimal-bootlinlabs_nand_4_256_multivolume.ubi
</span></span><span style=display:flex><span>core-image-minimal-bootlinlabs_nand_4_256_multivolume.ubinize.cfg.ubi
</span></span><span style=display:flex><span>core-image-minimal-bootlinlabs_nand_4_256.ubi
</span></span><span style=display:flex><span>core-image-minimal-bootlinlabs_nand_4_256.ubifs
</span></span><span style=display:flex><span>core-image-minimal-bootlinlabs_nand_4_256.ubinize.cfg.ubi
</span></span><span style=display:flex><span>core-image-minimal-bootlinlabs.tar.xz
</span></span><span style=display:flex><span>core-image-minimal-bootlinlabs.testdata.json
</span></span><span style=display:flex><span>flashlayout_core-image-minimal
</span></span><span style=display:flex><span>kernel
</span></span><span style=display:flex><span>scripts
</span></span></code></pre></td></tr></table></div></div><h3 id=distro-layer>Distro Layer</h3><p>通常 Distro Layer 會包含 Libc，initialization script, splash screen, &mldr; 等, 相關的配置會記錄在 <code>conf/distro/&lt;distro>.conf</code> 中。</p><p>在 <code>&lt;distro>.conf</code> 中必須包含 <code>DISTRO</code> 變數。例:</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-txt data-lang=txt><span style=display:flex><span>require conf/distro/poky.conf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DISTRO = &#34;distro&#34;
</span></span><span style=display:flex><span>DISTRO_NAME = &#34;distro description&#34;
</span></span><span style=display:flex><span>DISTRO_VERSTION = &#34;1.0&#34;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>MAINTAINER = &#34;...&#34;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># 提供的特性清單
</span></span><span style=display:flex><span>DISTRO_FEATURES = &#34;...&#34;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># 提供的特性清單，它同時會作用在 MACHINE_FEATURES 
</span></span><span style=display:flex><span>COMBINED_FEATURES = &#34;...&#34;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># Toolchain
</span></span><span style=display:flex><span>TCMODE = &#34;...&#34;
</span></span></code></pre></td></tr></table></div></div><h2 id=小結>小結</h2><p>本次實做的部份比較少，重心主要放在瞭解 machine，distro 的配置。</p><h2 id=參考連結>參考連結</h2><ul><li><a href=https://bootlin.com/doc/training/yocto-stm32/yocto-stm32-slides.pdf>Bootlin/Yocto with STM32</a></li><li><a href=https://bootlin.com/doc/training/yocto-stm32/yocto-stm32-labs.pdf>Bootlin/Yocto with STM32 Lab</a></li></ul></div><footer class=post-footer><div class=post-nav><a href=https://e61983.github.io/posts/stm32mp-with-yocto-2/ class=post-nav-prev><span class=nav-label>上一篇</span>
<span class=nav-title>在 STM32MP1 上使用 Yocto 建置 Linux 系統 2</span>
</a><a href=https://e61983.github.io/posts/stm32mp-with-yocto-4/ class=post-nav-next><span class=nav-label>下一篇</span>
<span class=nav-title>在 STM32MP1 上使用 Yocto 建置 Linux 系統 4</span></a></div></footer></article><aside class=post-sidebar><nav class="toc desktop-toc"><h3 class=toc-title>目錄</h3><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#主要內容>主要內容</a><ul><li><a href=#bsp-layer>BSP Layer</a></li><li><a href=#machine-常見的配置項>Machine 常見的配置項</a></li><li><a href=#bootloader-常見的配置項>Bootloader 常見的配置項</a></li><li><a href=#kernel-常見的配置項>Kernel 常見的配置項</a></li><li><a href=#kernel-metadata-常見的配置項>Kernel Metadata 常見的配置項</a></li><li><a href=#建立-bootlinlabs-machine>建立 bootlinlabs Machine</a></li><li><a href=#distro-layer>Distro Layer</a></li></ul></li><li><a href=#小結>小結</a></li><li><a href=#參考連結>參考連結</a></li></ul></nav></nav></aside></div></div><button id=backToTop class=back-to-top aria-label=回到頂部>
<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg></button></main><footer class=footer><div class=container><div class=footer-content><div class=social-links><a href=https://github.com/e61983 target=_blank rel=noopener class=social-link><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg>
GitHub</a></div><div class=copyright><p>&copy; 2025 Yuan. All rights reserved.</p><p>Powered by <a href=https://gohugo.io target=_blank rel=noopener>Hugo</a> & Yuan Theme</p></div></div></div></footer></div><script src=https://e61983.github.io/yuan/js/main.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js></script><script>hljs.highlightAll()</script></body></html>