<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Dockerfile 與 Docker Compose 寫法全攻略 - Yuan のノート</title><meta name=description content="心之所至，隨意亂書"><meta name=keywords content="golang,embedded,linux,backend,programming"><meta name=author content="Yuan"><meta property="og:title" content="Dockerfile 與 Docker Compose 寫法全攻略 - Yuan のノート"><meta property="og:description" content="心之所至，隨意亂書"><meta property="og:type" content="article"><meta property="og:url" content="https://e61983.github.io/posts/docker-compose-introduction/"><link rel=icon type=image/svg+xml href=/favicon.svg><link rel=icon type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/favicon.svg><meta name=theme-color content="#0d1117"><link rel=stylesheet href=https://e61983.github.io/yuan/css/main.min.css><link rel=stylesheet href=https://e61983.github.io/yuan/css/chroma.min.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Inter:wght@300;400;500;600;700&display=swap" rel=stylesheet></head><body class=theme-dark><div class=layout><header class=header><div class=container><div class=header-content><div class=header-brand><a href=https://e61983.github.io/ class=brand-link><span class=brand-text>Yuan のノート</span></a><p class=brand-subtitle>心之所至，隨意亂書</p></div><nav class=nav><ul class=nav-list><li class=nav-item><a href=/ class=nav-link>首頁</a></li><li class=nav-item><a href=/posts/ class=nav-link>文章</a></li><li class=nav-item><a href=/categories/ class=nav-link>分類</a></li><li class=nav-item><a href=/tags/ class=nav-link>標籤</a></li><li class=nav-item><a href=/archive/ class=nav-link>歸檔</a></li></ul></nav><button class=mobile-menu-toggle aria-label="Toggle menu">
<span class=hamburger></span>
<span class=hamburger></span>
<span class=hamburger></span></button></div></div></header><main class=main><div class=container><div class=post-layout><article class=post><header class=post-header><h1 class=post-title>Dockerfile 與 Docker Compose 寫法全攻略</h1><div class=post-meta><time class=post-date datetime=2025-08-27T23:24:29+08:00>2025年08月27日
</time><span class=reading-time>2 分鐘閱讀</span>
<span class=word-count>292 字</span>
<span class=post-author>by Yuan</span></div><div class=post-tags><a href=/tags/docker class=tag>docker</a>
<a href=/tags/docker-compose class=tag>docker-compose</a>
<a href=/tags/dockerfile class=tag>dockerfile</a>
<a href=/tags/containerization class=tag>containerization</a>
<a href=/tags/devops class=tag>devops</a></div><div class=post-categories><a href=/categories/backend class=category>backend</a></div></header><div class=mobile-toc-toggle><button class=toc-toggle-btn aria-label=顯示/隱藏目錄>
<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9h14V7H3v2zm0 4h14v-2H3v2zm0 4h14v-2H3v2zm16 0h2v-2h-2v2zm0-10v2h2V7h-2zm0 6h2v-2h-2v2z"/></svg>
目錄</button><nav class=mobile-toc><h3 class=toc-title>目錄</h3><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#dockerfile容器的食譜>Dockerfile：容器的食譜</a><ul><li><a href=#範例go-應用的-dockerfile>範例：Go 應用的 Dockerfile</a></li></ul></li><li><a href=#docker-compose多容器的劇本>Docker Compose：多容器的劇本</a><ul><li><a href=#範例api--postgres>範例：API + Postgres</a></li></ul></li><li><a href=#限制資源避免把主機吃爆>限制資源：避免把主機吃爆</a><ul><li><a href=#方法一compose-v2-寫法>方法一：Compose v2 寫法</a></li><li><a href=#方法二swarm-模式deploy-區塊>方法二：Swarm 模式（deploy 區塊）</a></li><li><a href=#方法三docker-run-參數>方法三：docker run 參數</a></li></ul></li><li><a href=#小節>小節</a></li><li><a href=#參考資料>參考資料</a></li></ul></nav></nav></div><div class=post-content><h2 id=前言>前言</h2><p>各位同學們應該常常聽到一句話：「有了 Docker，環境跑起來就不怕！」
不過當真的要寫 Dockerfile 或是 compose.yaml 的時候，十之八九就會卡在格式，或是跑一跑把主機資源吃爆。</p><p>這篇文章就來隨性聊聊：</p><ol><li>Dockerfile 怎麼寫。</li><li>Compose（compose.yaml）怎麼寫。</li><li>怎麼限制資源，避免主機 GG。</li></ol><h2 id=dockerfile容器的食譜>Dockerfile：容器的食譜</h2><p>Dockerfile 的角色就像是食譜，逐行告訴 Docker 怎麼建置你的應用環境。常見的幾個指令如下：</p><ul><li><strong>FROM</strong>：指定基礎映像，例如 <code>FROM python:3.11-slim</code>。</li><li><strong>WORKDIR</strong>：設定容器中的工作路徑。</li><li><strong>COPY / ADD</strong>：把檔案從宿主機複製到容器。</li><li><strong>RUN</strong>：建置階段要執行的指令（例如安裝套件）。</li><li><strong>CMD</strong>：定義容器啟動時要跑的預設指令。</li><li><strong>ENTRYPOINT</strong>：跟 CMD 類似，但更「強制」，適合固定的啟動行為。</li><li><strong>ENV</strong>：設定環境變數。</li><li><strong>EXPOSE</strong>：宣告容器會用到的 Port。</li></ul><h3 id=範例go-應用的-dockerfile>範例：Go 應用的 Dockerfile</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=ln> 1</span><span class=cl><span class=k>FROM</span><span class=s> golang:1.22-alpine</span><span class=err>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=err>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=err></span><span class=c># 安裝依賴</span><span class=err>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=err></span><span class=k>COPY</span> go.mod .<span class=err>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=err></span><span class=k>COPY</span> go.sum .<span class=err>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=err></span><span class=k>RUN</span> go mod download<span class=err>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=err>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=err></span><span class=c># 複製程式碼並建置</span><span class=err>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=err></span><span class=k>RUN</span> go build -o server .<span class=err>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=err>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=err></span><span class=c># 開放服務 Port</span><span class=err>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 8080</span><span class=err>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=err>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=err></span><span class=c># 啟動指令</span><span class=err>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;./server&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></div><p>這樣一份食譜，乾乾淨淨就能讓 Go 專案跑起來。</p><h2 id=docker-compose多容器的劇本>Docker Compose：多容器的劇本</h2><p>有了 Dockerfile 只是把環境建好，Compose 則是能讓多個服務一次跑起來，像是一份劇本協調大家該怎麼登場。</p><p>Compose 檔案基本結構：</p><ul><li><p><strong>version</strong>：Compose 檔案版本（v2 可以省略）。</p></li><li><p><strong>services</strong>：定義多個容器服務。</p><ul><li><strong>image</strong> 或 <strong>build</strong>：映像檔來源或建置方式。</li><li><strong>ports</strong>：Port 映射。</li><li><strong>volumes</strong>：資料卷掛載。</li><li><strong>environment</strong>：環境變數設定。</li><li><strong>depends_on</strong>：依賴的其他服務。</li></ul></li><li><p><strong>volumes</strong>：全域可重複使用的 Volume。</p></li><li><p><strong>networks</strong>：網路設定（選用）。</p></li></ul><h3 id=範例api--postgres>範例：API + Postgres</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3.9&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=nt>api</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>      </span>- <span class=s2>&#34;8080:8080&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>      </span>- <span class=l>./data:/app/data</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>      </span>- <span class=l>ENV=production</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>      </span>- <span class=l>db</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>    </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1.0&#34;</span><span class=w>       </span><span class=c># 限制最多 1 顆 CPU</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>    </span><span class=nt>mem_limit</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;512m&#34;</span><span class=w> </span><span class=c># 限制最多 512MB 記憶體</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=w>  </span><span class=nt>db</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres:16</span><span class=w>
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class=l>user</span><span class=w>
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=l>password</span><span class=w>
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class=l>demo</span><span class=w>
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=w>      </span>- <span class=l>db-data:/var/lib/postgresql/data</span><span class=w>
</span></span></span><span class=line><span class=ln>26</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln>27</span><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=w>  </span><span class=nt>db-data</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></div><p>這樣一份設定檔，直接就能 <code>docker compose up</code>，兩個服務就乖乖跑起來。</p><h2 id=限制資源避免把主機吃爆>限制資源：避免把主機吃爆</h2><p>Docker 容器如果不加限制，很容易就把主機 CPU、記憶體用到掛。各位同學們要學會「設限」，才能避免悲劇。</p><h3 id=方法一compose-v2-寫法>方法一：Compose v2 寫法</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln>1</span><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w>  </span><span class=nt>api</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w>    </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.5&#34;</span><span class=w>       </span><span class=c># 限制 0.5 顆 CPU</span><span class=w>
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=w>    </span><span class=nt>mem_limit</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;256m&#34;</span><span class=w> </span><span class=c># 限制 256MB 記憶體</span><span class=w>
</span></span></span></code></pre></div><p>這種寫法在 <code>docker compose up</code> 就會生效。</p><h3 id=方法二swarm-模式deploy-區塊>方法二：Swarm 模式（deploy 區塊）</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w>  </span><span class=nt>api</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>myapp:latest</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>      </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>        </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.5&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>256M</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>        </span><span class=nt>reservations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.25&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>128M</span><span class=w>
</span></span></span></code></pre></div><p>這種寫法只有在 Docker Swarm 或 Enterprise 環境才會真的限制。</p><h3 id=方法三docker-run-參數>方法三：docker run 參數</h3><p>不透過 Compose，直接下參數：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>docker run --cpus<span class=o>=</span><span class=s2>&#34;0.5&#34;</span> --memory<span class=o>=</span><span class=s2>&#34;256m&#34;</span> myapp:latest
</span></span></code></pre></div><h2 id=小節>小節</h2><p>各位同學們，Dockerfile 就像食譜，負責建置應用的料理過程；Compose 則像劇本，協調多個容器怎麼同台演出。加上資源限制，才不會變成「吃爆 RAM、把 CPU 跑滿」的慘案。</p><p>只要掌握了這些基本格式，接下來不管是學校專題還是 Side Project，都能很放心地用 Docker 把環境跑起來。</p><h2 id=參考資料>參考資料</h2><ul><li><a href=https://docs.docker.com/reference/dockerfile/>Dockerfile reference | Docker Docs</a></li><li><a href=https://docs.docker.com/compose/compose-file/>Compose file reference | Docker Docs</a></li><li><a href=https://docs.docker.com/config/containers/resource_constraints/>Resource constraints for containers | Docker Docs</a></li></ul></div><footer class=post-footer><div class=post-nav><a href=https://e61983.github.io/posts/otp-code-introduction/ class=post-nav-prev><span class=nav-label>上一篇</span>
<span class=nav-title>OTP — 一次性密碼的原理與實作</span></a></div></footer></article><aside class=post-sidebar><nav class="toc desktop-toc"><h3 class=toc-title>目錄</h3><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#dockerfile容器的食譜>Dockerfile：容器的食譜</a><ul><li><a href=#範例go-應用的-dockerfile>範例：Go 應用的 Dockerfile</a></li></ul></li><li><a href=#docker-compose多容器的劇本>Docker Compose：多容器的劇本</a><ul><li><a href=#範例api--postgres>範例：API + Postgres</a></li></ul></li><li><a href=#限制資源避免把主機吃爆>限制資源：避免把主機吃爆</a><ul><li><a href=#方法一compose-v2-寫法>方法一：Compose v2 寫法</a></li><li><a href=#方法二swarm-模式deploy-區塊>方法二：Swarm 模式（deploy 區塊）</a></li><li><a href=#方法三docker-run-參數>方法三：docker run 參數</a></li></ul></li><li><a href=#小節>小節</a></li><li><a href=#參考資料>參考資料</a></li></ul></nav></nav></aside></div></div><button id=backToTop class=back-to-top aria-label=回到頂部>
<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg></button></main><footer class=footer><div class=container><div class=footer-content><div class=social-links><a href=https://github.com/e61983 target=_blank rel=noopener class=social-link><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg>
GitHub</a></div><div class=copyright><p>&copy; 2025 Yuan. All rights reserved.</p><p>Powered by <a href=https://gohugo.io target=_blank rel=noopener>Hugo</a> & Yuan Theme</p></div></div></div></footer></div><script src=https://e61983.github.io/yuan/js/main.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-FQ2NLS0SEB"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-FQ2NLS0SEB",{send_page_view:!0,anonymize_ip:!0,allow_google_signals:!1,allow_ad_personalization_signals:!1})</script></body></html>