<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Dockerfile èˆ‡ Docker Compose å¯«æ³•å…¨æ”»ç•¥ - Yuan ã®ãƒãƒ¼ãƒˆ</title><meta name=description content="å¿ƒä¹‹æ‰€è‡³ï¼Œéš¨æ„äº‚æ›¸"><meta name=keywords content="golang,embedded,linux,backend,programming"><meta name=author content="Yuan"><meta property="og:title" content="Dockerfile èˆ‡ Docker Compose å¯«æ³•å…¨æ”»ç•¥ - Yuan ã®ãƒãƒ¼ãƒˆ"><meta property="og:description" content="å¿ƒä¹‹æ‰€è‡³ï¼Œéš¨æ„äº‚æ›¸"><meta property="og:type" content="article"><meta property="og:url" content="https://e61983.github.io/posts/docker-compose-introduction/"><link rel=icon type=image/svg+xml href=/favicon.svg><link rel=icon type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/favicon.svg><meta name=theme-color content="#0d1117"><link rel=stylesheet href=https://e61983.github.io/yuan/css/main.min.css><link rel=stylesheet href=https://e61983.github.io/yuan/css/chroma.min.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Inter:wght@300;400;500;600;700&display=swap" rel=stylesheet></head><body class=theme-dark><div class=layout><header class=header><div class=container><div class=header-content><div class=header-brand><a href=https://e61983.github.io/ class=brand-link><span class=brand-text>Yuan ã®ãƒãƒ¼ãƒˆ</span></a><p class=brand-subtitle>å¿ƒä¹‹æ‰€è‡³ï¼Œéš¨æ„äº‚æ›¸</p></div><nav class=nav><ul class=nav-list><li class=nav-item><a href=/ class=nav-link>é¦–é </a></li><li class=nav-item><a href=/posts/ class=nav-link>æ–‡ç« </a></li><li class=nav-item><a href=/categories/ class=nav-link>åˆ†é¡</a></li><li class=nav-item><a href=/tags/ class=nav-link>æ¨™ç±¤</a></li><li class=nav-item><a href=/archive/ class=nav-link>æ­¸æª”</a></li></ul></nav><button class=mobile-menu-toggle aria-label="Toggle menu">
<span class=hamburger></span>
<span class=hamburger></span>
<span class=hamburger></span></button></div></div></header><main class=main><div class=container><div class=post-layout><article class=post><header class=post-header><h1 class=post-title>Dockerfile èˆ‡ Docker Compose å¯«æ³•å…¨æ”»ç•¥</h1><div class=post-meta><time class=post-date datetime=2025-08-27T23:24:29+08:00>2025å¹´08æœˆ27æ—¥
</time><span class=reading-time>3 åˆ†é˜é–±è®€</span>
<span class=word-count>435 å­—</span>
<span class=post-author>by Yuan</span></div><div class=post-tags><a href=/tags/docker class=tag>docker</a>
<a href=/tags/docker-compose class=tag>docker-compose</a>
<a href=/tags/dockerfile class=tag>dockerfile</a>
<a href=/tags/containerization class=tag>containerization</a>
<a href=/tags/devops class=tag>devops</a></div><div class=post-categories><a href=/categories/backend class=category>backend</a></div></header><div class=mobile-toc-toggle><button class=toc-toggle-btn aria-label=é¡¯ç¤º/éš±è—ç›®éŒ„>
<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9h14V7H3v2zm0 4h14v-2H3v2zm0 4h14v-2H3v2zm16 0h2v-2h-2v2zm0-10v2h2V7h-2zm0 6h2v-2h-2v2z"/></svg>
ç›®éŒ„</button><nav class=mobile-toc><h3 class=toc-title>ç›®éŒ„</h3><nav id=TableOfContents><ul><li><a href=#å‰è¨€>å‰è¨€</a></li><li><a href=#dockerfileå®¹å™¨çš„é£Ÿè­œ>Dockerfileï¼šå®¹å™¨çš„é£Ÿè­œ</a><ul><li><a href=#ç¯„ä¾‹go-æ‡‰ç”¨çš„-dockerfile>ç¯„ä¾‹ï¼šGo æ‡‰ç”¨çš„ Dockerfile</a></li></ul></li><li><a href=#docker-composeå¤šå®¹å™¨çš„åŠ‡æœ¬>Docker Composeï¼šå¤šå®¹å™¨çš„åŠ‡æœ¬</a><ul><li><a href=#åŸºæœ¬çµæ§‹>åŸºæœ¬çµæ§‹</a></li><li><a href=#ç¯„ä¾‹api--postgres>ç¯„ä¾‹ï¼šAPI + Postgres</a></li></ul></li><li><a href=#èˆŠç‰ˆ-vs-æ–°ç‰ˆè³‡æºé™åˆ¶å°ç…§è¡¨>èˆŠç‰ˆ vs æ–°ç‰ˆï¼šè³‡æºé™åˆ¶å°ç…§è¡¨</a></li><li><a href=#é™åˆ¶è³‡æºé¿å…æŠŠä¸»æ©Ÿåƒçˆ†>é™åˆ¶è³‡æºï¼šé¿å…æŠŠä¸»æ©Ÿåƒçˆ†</a><ul><li><a href=#å–®æ©Ÿ-compose-å¯«æ³•>å–®æ©Ÿ Compose å¯«æ³•</a></li></ul></li><li><a href=#swarmè£œå……èªªæ˜>Swarmï¼šè£œå……èªªæ˜</a></li><li><a href=#gputpu-é™åˆ¶>GPU/TPU é™åˆ¶</a></li><li><a href=#docker-run-å¯«æ³•>docker run å¯«æ³•</a></li><li><a href=#å°çµ>å°çµ</a></li><li><a href=#åƒè€ƒè³‡æ–™>åƒè€ƒè³‡æ–™</a></li></ul></nav></nav></div><div class=post-content><h2 id=å‰è¨€>å‰è¨€</h2><p>å„ä½åŒå­¸æ‡‰è©²å¸¸å¸¸è½åˆ°ä¸€å¥è©±ï¼šã€Œæœ‰äº† Dockerï¼Œç’°å¢ƒè·‘èµ·ä¾†å°±ä¸æ€•ï¼ã€<br>ä½†çœŸçš„è¦å¯« Dockerfile æˆ– compose.yaml çš„æ™‚å€™ï¼Œåä¹‹å…«ä¹é‚„æ˜¯æœƒå¡åœ¨æ ¼å¼ï¼Œæˆ–ä¸å°å¿ƒè®“ä¸»æ©Ÿè³‡æºçˆ†æ‰ã€‚</p><p>é€™ç¯‡æ–‡ç« å°±ä¾†æ•´ç†ä¸€ä¸‹ 2025 å¹´çš„å¯¦å‹™å¯«æ³•ï¼š</p><ol><li>Dockerfile æ€éº¼å¯«ã€‚</li><li>Composeï¼ˆcompose.yamlï¼‰æ€éº¼å¯«ã€‚</li><li>æ€éº¼é™åˆ¶è³‡æºï¼Œé¿å…ä¸»æ©Ÿ GGã€‚</li></ol><h2 id=dockerfileå®¹å™¨çš„é£Ÿè­œ>Dockerfileï¼šå®¹å™¨çš„é£Ÿè­œ</h2><p>Dockerfile çš„è§’è‰²å°±åƒé£Ÿè­œï¼Œé€è¡Œå‘Šè¨´ Docker æ€éº¼å»ºç½®ä½ çš„æ‡‰ç”¨ç’°å¢ƒã€‚å¸¸è¦‹çš„å¹¾å€‹æŒ‡ä»¤å¦‚ä¸‹ï¼š</p><ul><li><strong>FROM</strong>ï¼šæŒ‡å®šåŸºç¤æ˜ åƒï¼Œä¾‹å¦‚ <code>FROM python:3.11-slim</code>ã€‚</li><li><strong>WORKDIR</strong>ï¼šè¨­å®šå®¹å™¨ä¸­çš„å·¥ä½œè·¯å¾‘ã€‚</li><li><strong>COPY / ADD</strong>ï¼šæŠŠæª”æ¡ˆå¾å®¿ä¸»æ©Ÿè¤‡è£½åˆ°å®¹å™¨ã€‚</li><li><strong>RUN</strong>ï¼šå»ºç½®éšæ®µè¦åŸ·è¡Œçš„æŒ‡ä»¤ï¼ˆä¾‹å¦‚å®‰è£å¥—ä»¶ï¼‰ã€‚</li><li><strong>CMD</strong>ï¼šå®šç¾©å®¹å™¨å•Ÿå‹•æ™‚è¦è·‘çš„é è¨­æŒ‡ä»¤ã€‚</li><li><strong>ENTRYPOINT</strong>ï¼šè·Ÿ CMD é¡ä¼¼ï¼Œä½†æ›´ã€Œå¼·åˆ¶ã€ï¼Œé©åˆå›ºå®šçš„å•Ÿå‹•è¡Œç‚ºã€‚</li><li><strong>ENV</strong>ï¼šè¨­å®šç’°å¢ƒè®Šæ•¸ã€‚</li><li><strong>EXPOSE</strong>ï¼šå®£å‘Šå®¹å™¨æœƒç”¨åˆ°çš„ Portï¼ˆåƒ…ä¾›æ–‡ä»¶ç”¨é€”ï¼Œå¯¦éš›ä»è¦ç”¨ <code>-p</code> æˆ– <code>ports</code>ï¼‰ã€‚</li></ul><h3 id=ç¯„ä¾‹go-æ‡‰ç”¨çš„-dockerfile>ç¯„ä¾‹ï¼šGo æ‡‰ç”¨çš„ Dockerfile</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=ln> 1</span><span class=cl><span class=k>FROM</span><span class=s> golang:1.22-alpine</span><span class=err>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=err>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=err></span><span class=c># å®‰è£ä¾è³´</span><span class=err>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=err></span><span class=k>COPY</span> go.mod .<span class=err>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=err></span><span class=k>COPY</span> go.sum .<span class=err>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=err></span><span class=k>RUN</span> go mod download<span class=err>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=err>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=err></span><span class=c># è¤‡è£½ç¨‹å¼ç¢¼ä¸¦å»ºç½®</span><span class=err>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=err></span><span class=k>RUN</span> go build -o server .<span class=err>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=err>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=err></span><span class=c># é–‹æ”¾æœå‹™ Port</span><span class=err>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 8080</span><span class=err>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=err>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=err></span><span class=c># å•Ÿå‹•æŒ‡ä»¤</span><span class=err>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;./server&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></div><p>ä¹¾ä¹¾æ·¨æ·¨çš„ä¸€ä»½é£Ÿè­œï¼Œå°±èƒ½è®“ Go å°ˆæ¡ˆè·‘èµ·ä¾†ã€‚</p><h2 id=docker-composeå¤šå®¹å™¨çš„åŠ‡æœ¬>Docker Composeï¼šå¤šå®¹å™¨çš„åŠ‡æœ¬</h2><p>æœ‰äº† Dockerfile åªæ˜¯å»ºå¥½ç’°å¢ƒï¼ŒCompose å‰‡åƒåŠ‡æœ¬ï¼Œèƒ½å”èª¿å¤šå€‹æœå‹™ä¸€æ¬¡è·‘èµ·ä¾†ã€‚</p><h3 id=åŸºæœ¬çµæ§‹>åŸºæœ¬çµæ§‹</h3><p>åœ¨ <strong>Compose v2</strong>ï¼ˆ2023 ä¹‹å¾Œï¼‰é–‹å§‹ï¼š</p><ul><li><code>version</code> æ¬„ä½ <strong>å¯ä»¥çœç•¥</strong>ï¼ŒCompose æœƒè‡ªå‹•åµæ¸¬ schemaã€‚</li><li><code>services</code>ï¼šå®šç¾©å¤šå€‹å®¹å™¨æœå‹™ã€‚</li><li><code>volumes</code>ã€<code>networks</code>ï¼šå…¨åŸŸè³‡æºã€‚</li></ul><h3 id=ç¯„ä¾‹api--postgres>ç¯„ä¾‹ï¼šAPI + Postgres</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w>  </span><span class=nt>api</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>      </span>- <span class=s2>&#34;8080:8080&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>      </span>- <span class=l>./data:/app/data</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>      </span>- <span class=l>ENV=production</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>      </span>- <span class=l>db</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>      </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>        </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1.0&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>512M</span><span class=w>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=w>  </span><span class=nt>db</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres:16</span><span class=w>
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class=l>user</span><span class=w>
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=l>password</span><span class=w>
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class=l>demo</span><span class=w>
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>26</span><span class=cl><span class=w>      </span>- <span class=l>db-data:/var/lib/postgresql/data</span><span class=w>
</span></span></span><span class=line><span class=ln>27</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>29</span><span class=cl><span class=w>  </span><span class=nt>db-data</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></div><p>ğŸ‘‰ æ³¨æ„ï¼š<br>éå»å¸¸è¦‹çš„ <code>cpus</code>ã€<code>mem_limit</code> å±¬æ€§ï¼Œåœ¨ v2 ä¸­é›–ç„¶é‚„èƒ½ç”¨ï¼Œä½†å·²ç¶“å±¬æ–¼ <strong>legacy å¯«æ³•</strong>ï¼Œå®˜æ–¹å»ºè­°æ”¹æˆ <code>deploy.resources</code>ã€‚</p><h2 id=èˆŠç‰ˆ-vs-æ–°ç‰ˆè³‡æºé™åˆ¶å°ç…§è¡¨>èˆŠç‰ˆ vs æ–°ç‰ˆï¼šè³‡æºé™åˆ¶å°ç…§è¡¨</h2><table><thead><tr><th>åŠŸèƒ½</th><th>èˆŠç‰ˆå¯«æ³• (legacy)</th><th>æ–°ç‰ˆå»ºè­°å¯«æ³• (v2)</th></tr></thead><tbody><tr><td>é™åˆ¶ CPU</td><td><code>cpus: "1.0"</code></td><td><code>deploy.resources.limits.cpus: "1.0"</code></td></tr><tr><td>é™åˆ¶è¨˜æ†¶é«”</td><td><code>mem_limit: "512m"</code></td><td><code>deploy.resources.limits.memory: 512M</code></td></tr><tr><td>ä¿è­‰è³‡æº</td><td>ç„¡</td><td><code>deploy.resources.reservations</code></td></tr><tr><td>å¤šå‰¯æœ¬</td><td><code>scale: 3</code>ï¼ˆå·²å»¢æ£„ï¼‰</td><td><code>deploy.replicas: 3</code>ï¼ˆSwarm æ‰ç”Ÿæ•ˆï¼‰</td></tr></tbody></table><p>ğŸ‘‰ å°çµï¼š</p><ul><li><strong>å–®æ©Ÿç’°å¢ƒ</strong>ï¼šåªæœƒå¥—ç”¨ <code>limits.memory</code> èˆ‡ <code>limits.cpus</code>ã€‚</li><li><strong>Swarm ç’°å¢ƒ</strong>ï¼š<code>replicas</code>ã€<code>placement</code>ã€<code>reservations</code> æ‰æœƒç”Ÿæ•ˆã€‚</li></ul><h2 id=é™åˆ¶è³‡æºé¿å…æŠŠä¸»æ©Ÿåƒçˆ†>é™åˆ¶è³‡æºï¼šé¿å…æŠŠä¸»æ©Ÿåƒçˆ†</h2><p>å¦‚æœæ²’æœ‰è¨­é™ï¼Œå®¹å™¨å¾ˆå®¹æ˜“å°±æŠŠä¸»æ©Ÿ CPUã€è¨˜æ†¶é«”åƒå…‰å…‰ã€‚<br>åœ¨ Compose v2ï¼Œå»ºè­°ç”¨ <code>deploy.resources</code> ä¾†æ§åˆ¶ã€‚</p><h3 id=å–®æ©Ÿ-compose-å¯«æ³•>å–®æ©Ÿ Compose å¯«æ³•</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln>1</span><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w>  </span><span class=nt>api</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=w>      </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=w>        </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.5&#34;</span><span class=w>   </span><span class=c># é™åˆ¶ 0.5 é¡† CPU</span><span class=w>
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>256M </span><span class=w> </span><span class=c># é™åˆ¶ 256MB è¨˜æ†¶é«”</span><span class=w>
</span></span></span></code></pre></div><p>é›–ç„¶ <code>deploy</code> æœ€åˆæ˜¯çµ¦ Docker Swarm ç”¨çš„ï¼Œä½†åœ¨ Compose v2ï¼ˆå–®æ©Ÿæ¨¡å¼ï¼‰ä¹Ÿèƒ½å¥—ç”¨ <strong>è³‡æºé™åˆ¶</strong>ã€‚</p><hr><h2 id=swarmè£œå……èªªæ˜>Swarmï¼šè£œå……èªªæ˜</h2><p><code>deploy</code> å€å¡Šå®Œæ•´åŠŸèƒ½ï¼ˆreplicasã€placementã€update_config&mldr;ï¼‰åŸæœ¬æ˜¯è¨­è¨ˆçµ¦ <strong>Docker Swarm</strong> çš„ã€‚</p><p>ä¸éè¦æé†’ï¼š</p><ul><li><strong>Swarm åœ¨ 2023 å¾Œå·²é€²å…¥ç¶­è­·æ¨¡å¼</strong>ï¼Œå®˜æ–¹é‡å¿ƒå·²ç¶“ç§»åˆ° Kubernetesã€‚</li><li>å–®æ©Ÿ Compose é›–ç„¶èƒ½åƒåˆ°éƒ¨åˆ† <code>deploy.resources</code>ï¼Œä½†åƒ <code>replicas</code>ã€<code>placement</code> åœ¨é Swarm ç’°å¢ƒä¸¦ä¸æœƒç”Ÿæ•ˆã€‚</li></ul><p>ğŸ‘‰ å¦‚æœæ˜¯æ–°å°ˆæ¡ˆï¼Œä¸å»ºè­°å†æŠ•è³‡ Swarmï¼Œæ‡‰è©²ç›´æ¥è€ƒæ…® Kubernetes æˆ–å–®æ©Ÿ Composeã€‚</p><h2 id=gputpu-é™åˆ¶>GPU/TPU é™åˆ¶</h2><p>åœ¨ AI/ML å ´æ™¯ï¼Œå¸¸å¸¸éœ€è¦ GPUã€‚<br>åœ¨ Compose v2.5 ä¹‹å¾Œï¼Œå¯ä»¥é€™æ¨£å¯«ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w>  </span><span class=nt>trainer</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>tensorflow/tensorflow:latest-gpu</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>      </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>        </span><span class=nt>reservations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>          </span><span class=nt>devices</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>            </span>- <span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>nvidia</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>              </span><span class=nt>count</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>              </span><span class=nt>capabilities</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>gpu]</span><span class=w>
</span></span></span></code></pre></div><p>ğŸ‘‰ è£œå……ï¼š</p><ul><li>éœ€è¦å®‰è£ <a href=https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/>NVIDIA Container Toolkit</a>ã€‚</li><li>ç­‰åƒ¹æ–¼ <code>docker run --gpus 1</code>ã€‚</li><li>èˆŠçš„ <code>capabilities: ["nvidia-compute"]</code> ä»èƒ½ç”¨ï¼Œä½†å»ºè­°ç”¨ <code>driver: nvidia</code> + <code>capabilities: [gpu]</code>ã€‚</li></ul><h2 id=docker-run-å¯«æ³•>docker run å¯«æ³•</h2><p>ä¸é€é Composeï¼Œä¹Ÿèƒ½åœ¨ <code>docker run</code> é™åˆ¶ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>docker run --cpus<span class=o>=</span><span class=s2>&#34;0.5&#34;</span> --memory<span class=o>=</span><span class=s2>&#34;256m&#34;</span> myapp:latest
</span></span></code></pre></div><ul><li><code>--cpus</code> éœ€è¦ <strong>cgroup v2</strong> æ”¯æ´ï¼ˆå¤§éƒ¨åˆ† Linux å·²é è¨­å•Ÿç”¨ï¼‰ã€‚</li><li>åœ¨ macOS/Windows çš„ Docker Desktopï¼Œé™åˆ¶æœƒä½œç”¨åœ¨ <strong>VM å±¤ç´š</strong>ï¼Œä¸æ˜¯åŸç”Ÿå®¿ä¸»æ©Ÿã€‚</li></ul><h2 id=å°çµ>å°çµ</h2><p>åˆ° 2025 å¹´ç‚ºæ­¢ï¼Œå¹¾å€‹è¦é»å¯ä»¥è¨˜ä½ï¼š</p><ol><li><strong><code>version</code> å¯çœç•¥</strong> â†’ Compose v2 æœƒè‡ªå‹•åµæ¸¬ã€‚</li><li><strong><code>cpus</code>ã€<code>mem_limit</code> æ˜¯èˆŠå¯«æ³•</strong> â†’ æ”¹ç”¨ <code>deploy.resources</code>ã€‚</li><li><strong>Swarm å·²é€²å…¥ç¶­è­·æ¨¡å¼</strong> â†’ æ–°å°ˆæ¡ˆä¸è¦å†ç”¨ã€‚</li><li><strong>GPU æ”¯æ´é  NVIDIA Container Toolkit</strong> â†’ <code>deploy.resources.devices</code> æˆ– <code>--gpus</code>ã€‚</li><li><strong>Docker Desktop é™åˆ¶</strong> â†’ è¨­å®šå¥—ç”¨åœ¨ VMï¼Œä¸æ˜¯å®¿ä¸»æ©Ÿã€‚</li></ol><h2 id=åƒè€ƒè³‡æ–™>åƒè€ƒè³‡æ–™</h2><ul><li><a href=https://docs.docker.com/reference/dockerfile/>Dockerfile reference | Docker Docs</a></li><li><a href=https://docs.docker.com/compose/compose-file/>Compose file reference | Docker Docs</a></li><li><a href=https://docs.docker.com/reference/compose-file/deploy/>Deploy configuration | Docker Docs</a></li><li><a href=https://docs.docker.com/config/containers/resource_constraints/>Resource constraints for containers | Docker Docs</a></li><li><a href=https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/>NVIDIA Container Toolkit</a></li></ul></div><footer class=post-footer><div class=post-nav><a href=https://e61983.github.io/posts/otp-code-introduction/ class=post-nav-prev><span class=nav-label>ä¸Šä¸€ç¯‡</span>
<span class=nav-title>OTP â€” ä¸€æ¬¡æ€§å¯†ç¢¼çš„åŸç†èˆ‡å¯¦ä½œ</span></a></div></footer></article><aside class=post-sidebar><nav class="toc desktop-toc"><h3 class=toc-title>ç›®éŒ„</h3><nav id=TableOfContents><ul><li><a href=#å‰è¨€>å‰è¨€</a></li><li><a href=#dockerfileå®¹å™¨çš„é£Ÿè­œ>Dockerfileï¼šå®¹å™¨çš„é£Ÿè­œ</a><ul><li><a href=#ç¯„ä¾‹go-æ‡‰ç”¨çš„-dockerfile>ç¯„ä¾‹ï¼šGo æ‡‰ç”¨çš„ Dockerfile</a></li></ul></li><li><a href=#docker-composeå¤šå®¹å™¨çš„åŠ‡æœ¬>Docker Composeï¼šå¤šå®¹å™¨çš„åŠ‡æœ¬</a><ul><li><a href=#åŸºæœ¬çµæ§‹>åŸºæœ¬çµæ§‹</a></li><li><a href=#ç¯„ä¾‹api--postgres>ç¯„ä¾‹ï¼šAPI + Postgres</a></li></ul></li><li><a href=#èˆŠç‰ˆ-vs-æ–°ç‰ˆè³‡æºé™åˆ¶å°ç…§è¡¨>èˆŠç‰ˆ vs æ–°ç‰ˆï¼šè³‡æºé™åˆ¶å°ç…§è¡¨</a></li><li><a href=#é™åˆ¶è³‡æºé¿å…æŠŠä¸»æ©Ÿåƒçˆ†>é™åˆ¶è³‡æºï¼šé¿å…æŠŠä¸»æ©Ÿåƒçˆ†</a><ul><li><a href=#å–®æ©Ÿ-compose-å¯«æ³•>å–®æ©Ÿ Compose å¯«æ³•</a></li></ul></li><li><a href=#swarmè£œå……èªªæ˜>Swarmï¼šè£œå……èªªæ˜</a></li><li><a href=#gputpu-é™åˆ¶>GPU/TPU é™åˆ¶</a></li><li><a href=#docker-run-å¯«æ³•>docker run å¯«æ³•</a></li><li><a href=#å°çµ>å°çµ</a></li><li><a href=#åƒè€ƒè³‡æ–™>åƒè€ƒè³‡æ–™</a></li></ul></nav></nav></aside></div></div><button id=backToTop class=back-to-top aria-label=å›åˆ°é ‚éƒ¨>
<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg></button></main><footer class=footer><div class=container><div class=footer-content><div class=social-links><a href=https://github.com/e61983 target=_blank rel=noopener class=social-link><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg>
GitHub</a></div><div class=copyright><p>&copy; 2025 Yuan. All rights reserved.</p><p>Powered by <a href=https://gohugo.io target=_blank rel=noopener>Hugo</a> & Yuan Theme</p></div></div></div></footer></div><script src=https://e61983.github.io/yuan/js/main.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-FQ2NLS0SEB"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-FQ2NLS0SEB",{send_page_view:!0,anonymize_ip:!0,allow_google_signals:!1,allow_ad_personalization_signals:!1})</script></body></html>