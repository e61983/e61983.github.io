<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>初探 GraphQL - Yuan のノート</title><meta name=description content="心之所至，隨意亂書"><meta name=keywords content="golang,embedded,linux,backend,programming"><meta name=author content="Yuan"><meta property="og:title" content="初探 GraphQL - Yuan のノート"><meta property="og:description" content="心之所至，隨意亂書"><meta property="og:type" content="article"><meta property="og:url" content="https://e61983.github.io/posts/graphql-introduction/"><link rel=icon type=image/svg+xml href=/favicon.svg><link rel=icon type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/favicon.svg><meta name=theme-color content="#0d1117"><link rel=stylesheet href=https://e61983.github.io/yuan/css/main.min.css><link rel=stylesheet href=https://e61983.github.io/yuan/css/chroma.min.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Inter:wght@300;400;500;600;700&display=swap" rel=stylesheet></head><body class=theme-dark><div class=layout><header class=header><div class=container><div class=header-content><div class=header-brand><a href=https://e61983.github.io/ class=brand-link><span class=brand-text>Yuan のノート</span></a><p class=brand-subtitle>心之所至，隨意亂書</p></div><nav class=nav><ul class=nav-list><li class=nav-item><a href=/ class=nav-link>首頁</a></li><li class=nav-item><a href=/posts/ class=nav-link>文章</a></li><li class=nav-item><a href=/categories/ class=nav-link>分類</a></li><li class=nav-item><a href=/tags/ class=nav-link>標籤</a></li><li class=nav-item><a href=/archive/ class=nav-link>歸檔</a></li></ul></nav><button class=mobile-menu-toggle aria-label="Toggle menu">
<span class=hamburger></span>
<span class=hamburger></span>
<span class=hamburger></span></button></div></div></header><main class=main><div class=container><div class=post-layout><article class=post><header class=post-header><h1 class=post-title>初探 GraphQL</h1><div class=post-meta><time class=post-date datetime=2025-11-10T12:28:16+08:00>2025年11月10日
</time><span class=reading-time>3 分鐘閱讀</span>
<span class=word-count>483 字</span>
<span class=post-author>by Yuan</span></div><div class=post-categories><a href=/categories/backend class=category>backend</a>
<a href=/categories/go class=category>go</a>
<a href=/categories/graphql class=category>graphql</a></div></header><div class=mobile-toc-toggle><button class=toc-toggle-btn aria-label=顯示/隱藏目錄>
<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9h14V7H3v2zm0 4h14v-2H3v2zm0 4h14v-2H3v2zm16 0h2v-2h-2v2zm0-10v2h2V7h-2zm0 6h2v-2h-2v2z"/></svg>
目錄</button><nav class=mobile-toc><h3 class=toc-title>目錄</h3><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#主要內容>主要內容</a><ul><li><a href=#為什麼使用-graphql>為什麼使用 GraphQL</a></li><li><a href=#graphql-的語法基礎>GraphQL 的語法基礎</a></li><li><a href=#撰寫-query與-mutation>撰寫 Query（與 Mutation）</a></li><li><a href=#權限控制>權限控制</a></li><li><a href=#小結>小結</a></li></ul></li><li><a href=#參考連結>參考連結</a></li></ul></nav></nav></div><div class=post-content><h2 id=前言>前言</h2><p>最近在準備嘗試提供 GrapchQL API，所以在開始前先究了一下筆者感性趣的部份。
本篇文章雖然還不會實際使用程式碼產生器 <a href=https://gqlgen.com/>gqlgen</a>，但還是先對於「權限管理」的部份稍稍的提到一些。
於是這篇就這樣誕生啦~</p><h2 id=主要內容>主要內容</h2><h3 id=為什麼使用-graphql>為什麼使用 GraphQL</h3><p>在考慮 API 設計時，同學們可能會傳統地想到 REST。
那麼，為什麼會想要使用 GraphQL 呢？</p><p>官方文件：</p><ul><li>GraphQL 是一種「為你的 API 所定義的查詢語言」與「在服務端執行查詢的執行時 (runtime)」。</li><li>它不受限於特定資料庫或儲存引擎。</li><li>它允許客戶端「精確查詢自己需要的資料」，而不是被迫取得多餘或不足的資料。</li><li>它也支援 API 的演進，而不是透過版本化 (versioning) 的方式來管理變動。</li></ul><p>舉個栗子：
如果把 API 想像成「菜單」給前端看，傳統的 REST 有時像「套餐固定」，拿到的是固定內容；而 GraphQL 則「可以自己選菜」—只選想吃的、減少浪費。</p><p>因此，如果應用場景是：前端／客戶端需要較為靈活地提出複雜查詢、資料來源多、需要盡量減少 round‐trip 或 overfetch／underfetch，GraphQL 是很值得考慮的。
當然，並非所有場景都適合（例如非常簡單的 CRUD、或者服務間輕量通訊可能仍是 REST 或 gRPC 更合適）。</p><h3 id=graphql-的語法基礎>GraphQL 的語法基礎</h3><p>GraphQL 的核心由 <strong>schema（模式）／type 系統</strong>、<strong>query／mutation</strong>、以及 <strong>解析 (resolver)</strong> 三大要素組成。以下依序說明。</p><h4 id=定義-schema-與-type>定義 Schema 與 Type</h4><p>在 GraphQL 中，先必須定義 API 所支援的型別 (types) 及其欄位 (fields)，然後為每個欄位撰寫對應的解析函式 (resolver)。
官方範例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-graphql data-lang=graphql><span class=line><span class=ln>1</span><span class=cl><span class=kd>type</span><span class=w> </span><span class=nc>Query</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w>  </span><span class=py>me</span><span class=p>:</span><span class=w> </span><span class=nc>User</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=w></span><span class=kd>type</span><span class=w> </span><span class=nc>User</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=w>  </span><span class=py>name</span><span class=p>:</span><span class=w> </span><span class=nc>String</span><span class=w>
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>同學們需要在服務端提供 <code>me</code> 欄位的 resolver，比如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=ln>1</span><span class=cl><span class=kd>function</span> <span class=nx>resolveQueryMe</span><span class=p>(</span><span class=nx>_parent</span><span class=p>,</span> <span class=nx>_args</span><span class=p>,</span> <span class=nx>context</span><span class=p>,</span> <span class=nx>_info</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>  <span class=k>return</span> <span class=nx>context</span><span class=p>.</span><span class=nx>request</span><span class=p>.</span><span class=nx>auth</span><span class=p>.</span><span class=nx>user</span><span class=p>;</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=kd>function</span> <span class=nx>resolveUserName</span><span class=p>(</span><span class=nx>user</span><span class=p>,</span> <span class=nx>_args</span><span class=p>,</span> <span class=nx>context</span><span class=p>,</span> <span class=nx>_info</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>6</span><span class=cl>  <span class=k>return</span> <span class=nx>context</span><span class=p>.</span><span class=nx>db</span><span class=p>.</span><span class=nx>getUserFullName</span><span class=p>(</span><span class=nx>user</span><span class=p>.</span><span class=nx>id</span><span class=p>);</span>
</span></span><span class=line><span class=ln>7</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>重點在於：</p><ul><li>API 描述變成 type system，而不是只靠 endpoint 路由。</li><li>客戶端查詢 (query) 的語法會「鏡像」我們所需要的資料形狀。</li><li>解析器負責把 type 欄位對應到真正的資料來源（例如資料庫、服務端邏輯）。</li></ul><h3 id=撰寫-query與-mutation>撰寫 Query（與 Mutation）</h3><p>一旦 Schema 定義好，就可以接受客戶端提出查詢。範例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-graphql data-lang=graphql><span class=line><span class=ln>1</span><span class=cl><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w>  </span><span class=py>me</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w>    </span><span class=py>name</span><span class=w>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>這會回傳：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=ln>1</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>  <span class=nt>&#34;data&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>    <span class=nt>&#34;me&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>      <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Luke Skywalker&#34;</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>6</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>7</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>這裡可以看到：</p><ul><li>客戶端只拿到「需要的欄位」name，而不會拿到不需要的 fullName、nickname。</li><li>也不需要版本化 API。當有新增欄位時，仍舊支援舊的查詢。官方示例中提到將 <code>User</code> 從 <code>name</code> 擴充至 <code>fullName</code> 與 <code>nickname</code>，並把 <code>name</code> 標記為 <code>@deprecated</code>：</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-graphql data-lang=graphql><span class=line><span class=ln>1</span><span class=cl><span class=kd>type</span><span class=w> </span><span class=nc>User</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w>  </span><span class=py>fullName</span><span class=p>:</span><span class=w> </span><span class=nc>String</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w>  </span><span class=py>nickname</span><span class=p>:</span><span class=w> </span><span class=nc>String</span><span class=w>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w>  </span><span class=py>name</span><span class=p>:</span><span class=w> </span><span class=nc>String</span><span class=w> </span><span class=nd>@deprecated</span><span class=p>(</span><span class=py>reason</span><span class=p>:</span><span class=w> </span><span class=s>&#34;Use `fullName`.&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=權限控制>權限控制</h3><p>理解了語法與基礎後，接下來看「如何在 Go 語言環境中為 GraphQL 加上驗證 (Authentication) 與授權 (Authorization)」。
以下內容主要參考了 gqlgen + 中介軟體 (middleware) + 自訂指令 (directives) 的實作。</p><h4 id=驗證-authentication-與授權-authorization-的差異>驗證 (Authentication) 與授權 (Authorization) 的差異</h4><ul><li><strong>驗證 (Authentication)</strong>：確認使用者是誰（例如用 JWT token 驗證身份）</li><li><strong>授權 (Authorization)</strong>：確認這位使用者「是否有權」執行某操作或存取特定欄位／資源</li></ul><h4 id=使用-graphql-directive-在-schema-層做控制>使用 GraphQL Directive 在 Schema 層做控制</h4><p>在 Go 的 gqlgen 中，你可以定義自訂 directive。例如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-graphql data-lang=graphql><span class=line><span class=ln>1</span><span class=cl><span class=kd>directive</span><span class=w> </span><span class=nd>@auth</span><span class=p>(</span><span class=py>roles</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=nc>String</span><span class=p>!])</span><span class=w> </span><span class=kd>on</span><span class=w> </span><span class=kc>FIELD_DEFINITION</span><span class=w>
</span></span></span></code></pre></div><p>並在 Schema 中這樣用：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-graphql data-lang=graphql><span class=line><span class=ln>1</span><span class=cl><span class=kd>type</span><span class=w> </span><span class=nc>Query</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w>  </span><span class=py>listUsers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=nc>User</span><span class=p>]!</span><span class=w> </span><span class=nd>@auth</span><span class=p>(</span><span class=py>roles</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s>&#34;ADMIN&#34;</span><span class=p>])</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w>  </span><span class=nc>currentUserProfile</span><span class=p>:</span><span class=w> </span><span class=nc>User</span><span class=w> </span><span class=nd>@auth</span><span class=w>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>上面兩條的意義分別為：</p><ul><li><code>listUsers</code> 僅允許角色為 <code>ADMIN</code> 的使用者。</li><li><code>currentUserProfile</code> 只要經過認證即可（沒有指定角色）。</li></ul><h4 id=實作步驟>實作步驟</h4><ol><li><p><strong>定義 directive</strong>：在 schema 文件中宣告 <code>@auth</code>。</p></li><li><p><strong>在 middleware 驗證 JWT</strong>：在 HTTP 層（如使用 Echo、Gin 等）攔截 <code>Authorization</code> header，解析 JWT、抽取 claims（例如 email／role），將使用者資訊存入 context。 ([Medium][3])</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=ln> 1</span><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>AuthMiddleware</span><span class=p>(</span><span class=nx>next</span><span class=w> </span><span class=nx>echo</span><span class=p>.</span><span class=nx>HandlerFunc</span><span class=p>)</span><span class=w> </span><span class=nx>echo</span><span class=p>.</span><span class=nx>HandlerFunc</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>c</span><span class=w> </span><span class=nx>echo</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>    </span><span class=nx>authHeader</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>c</span><span class=p>.</span><span class=nf>Request</span><span class=p>().</span><span class=nx>Header</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=s>&#34;Authorization&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>    </span><span class=nx>tokenString</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>strings</span><span class=p>.</span><span class=nf>TrimPrefix</span><span class=p>(</span><span class=nx>authHeader</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Bearer &#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>    </span><span class=c1>// 驗證 token</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>    </span><span class=c1>// 取出 user、role</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>    </span><span class=nx>ctx</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nf>WithValue</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nf>Request</span><span class=p>().</span><span class=nf>Context</span><span class=p>(),</span><span class=w> </span><span class=nx>userContextKey</span><span class=p>,</span><span class=w> </span><span class=nx>user</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>    </span><span class=nx>c</span><span class=p>.</span><span class=nf>SetRequest</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nf>Request</span><span class=p>().</span><span class=nf>WithContext</span><span class=p>(</span><span class=nx>ctx</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nf>next</span><span class=p>(</span><span class=nx>c</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div></li><li><p><strong>實作 directive 處理函式</strong>：例如 <code>AuthDirective</code>，它會從 context 拿出 user，檢查「是否驗證過」及「是否具備指定角色」。若沒通過，則回傳錯誤。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=ln> 1</span><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>AuthDirective</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>obj</span><span class=w> </span><span class=kd>interface</span><span class=p>{},</span><span class=w> </span><span class=nx>next</span><span class=w> </span><span class=nx>graphql</span><span class=p>.</span><span class=nx>Resolver</span><span class=p>,</span><span class=w> </span><span class=nx>roles</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=kd>interface</span><span class=p>{},</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w>  </span><span class=nx>user</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nf>GetUserFromContext</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>ok</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;unauthenticated&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>roles</span><span class=p>)</span><span class=o>==</span><span class=mi>0</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>    </span><span class=c1>// 只要驗證過即可</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nf>next</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>  </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>role</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>roles</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>user</span><span class=p>.</span><span class=nx>Role</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=nx>role</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>      </span><span class=k>return</span><span class=w> </span><span class=nf>next</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;unauthorized: requires roles %v&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>roles</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div></li><li><p><strong>在 gqlgen 設定中註冊 directive</strong>：在 <code>gqlgen.yml</code> 或設定函式中指定 <code>Auth: AuthDirective</code>。</p></li></ol><h4 id=為什麼這樣做好>為什麼這樣做好？</h4><ul><li>將「誰可以查哪個欄位」的邏輯寫進 Schema（使用 @auth ）——可讀性高、維護容易。</li><li>將驗證（JWT、中介）與授權（directive）分離，使邏輯清楚、重用容易。</li><li>適合使用 Go + gqlgen 架構的情境：已有後端、也想為查詢加上安全層。</li></ul><h4 id=注意事項>注意事項</h4><ul><li>JWT 驗證的密鑰管理、過期控制、Token 刷新機制…這些不是 GraphQL 特有，但必須妥善設計。</li><li>欄位級別的授權會比僅在 Query／Mutation 層更細，但也更複雜。你須評估是否真正有需要。</li><li>Schema 隨時間演進時，若新增欄位但忘記授權指令，可能造成安全漏洞。</li><li>當後端還有第三方資料來源、多服務整合、Gateway 架構時（例如多個 GraphQL 服務合併），授權邏輯可能更複雜。</li></ul><h3 id=小結>小結</h3><ul><li>GraphQL 是一種強大且靈活的 API 查詢語言／運行時系統，適合客戶端對資料存取有彈性需求的場景。</li><li>基礎流程：定義 Schema → 撰寫 Resolver → 客戶端查詢，並且可以進行 API 演進而不用版本化。</li><li>在 Go 語言環境中，使用 gqlgen + 自訂 @auth directive ＋ JWT middleware，就可以為 GraphQL API 架構可靠的授權機制。</li><li>實作時要同步關注驗證、授權、安全性（例如資料洩漏／過度存取）與維護性。</li></ul><h2 id=參考連結>參考連結</h2><ul><li><a href=https://graphql.org/learn/>Introduction to GraphQL | GraphQL</a></li><li><a href=https://blog.wu-boy.com/categories/graphql/>使用 GraphQL Gateway 串接多個 Data Schema</a></li><li><a href=https://medium.com/%40purisaurabh/securing-graphql-in-golang-using-directives-for-authentication-authorization-2cd689f02fd7>Securing GraphQL in Golang using Directives for Authentication & Authorization</a></li></ul></div><footer class=post-footer><div class=post-nav><a href=https://e61983.github.io/posts/rabbitmq-introduction/ class=post-nav-prev><span class=nav-label>上一篇</span>
<span class=nav-title>RabbitMQ！鎹鴉傳信的分工法 - 通往地獄的開始？！</span></a></div></footer></article><aside class=post-sidebar><nav class="toc desktop-toc"><h3 class=toc-title>目錄</h3><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#主要內容>主要內容</a><ul><li><a href=#為什麼使用-graphql>為什麼使用 GraphQL</a></li><li><a href=#graphql-的語法基礎>GraphQL 的語法基礎</a></li><li><a href=#撰寫-query與-mutation>撰寫 Query（與 Mutation）</a></li><li><a href=#權限控制>權限控制</a></li><li><a href=#小結>小結</a></li></ul></li><li><a href=#參考連結>參考連結</a></li></ul></nav></nav></aside></div></div><button id=backToTop class=back-to-top aria-label=回到頂部>
<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg></button></main><footer class=footer><div class=container><div class=footer-content><div class=social-links><a href=https://github.com/e61983 target=_blank rel=noopener class=social-link><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg>
GitHub</a></div><div class=copyright><p>&copy; 2025 Yuan. All rights reserved.</p><p>Powered by <a href=https://gohugo.io target=_blank rel=noopener>Hugo</a> & Yuan Theme</p></div></div></div></footer></div><script src=https://e61983.github.io/yuan/js/main.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-FQ2NLS0SEB"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-FQ2NLS0SEB",{send_page_view:!0,anonymize_ip:!0,allow_google_signals:!1,allow_ad_personalization_signals:!1})</script></body></html>