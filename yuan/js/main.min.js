document.addEventListener("DOMContentLoaded",function(){const t=document.querySelector(".mobile-menu-toggle"),n=document.querySelector(".nav");t&&n&&t.addEventListener("click",function(){n.classList.toggle("active"),t.classList.toggle("active")});const e=document.getElementById("backToTop");e&&(window.addEventListener("scroll",function(){window.pageYOffset>300?e.classList.add("visible"):e.classList.remove("visible")}),e.addEventListener("click",function(){window.scrollTo({top:0,behavior:"smooth"})})),addCopyButtonsToCodeBlocks(),initLanguageTags(),initTableOfContents(),initMobileTocToggle(),initTocActiveTracking(),initLazyLoading(),initThemeToggle()});function addCopyButtonsToCodeBlocks(){const e=document.querySelectorAll("pre code");e.forEach(function(e){const n=e.parentElement,t=document.createElement("button");t.className="copy-button",t.innerHTML=`
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
        `,n.style.position="relative",n.appendChild(t),t.addEventListener("click",function(){const n=e.textContent;navigator.clipboard?navigator.clipboard.writeText(n).then(function(){showCopySuccess(t)}).catch(function(){fallbackCopyToClipboard(n,t)}):fallbackCopyToClipboard(n,t)})})}function fallbackCopyToClipboard(e,t){const n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.left="-999999px",n.style.top="-999999px",document.body.appendChild(n),n.focus(),n.select();try{document.execCommand("copy"),showCopySuccess(t)}catch(e){console.error("Copy failed:",e)}document.body.removeChild(n)}function showCopySuccess(e){const t=e.innerHTML;e.innerHTML=`
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="20,6 9,17 4,12"></polyline>
        </svg>
    `,e.classList.add("copied"),setTimeout(function(){e.innerHTML=t,e.classList.remove("copied")},2e3)}function initTableOfContents(){const e=document.querySelectorAll('.toc a[href^="#"]');e.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();const n=this.getAttribute("href").substring(1),t=document.getElementById(n);if(t){const e=document.querySelector(".header").offsetHeight,n=t.offsetTop-e-20;window.scrollTo({top:n,behavior:"smooth"})}})})}function initLazyLoading(){if("IntersectionObserver"in window){const e=new IntersectionObserver(function(t){t.forEach(function(t){if(t.isIntersecting){const n=t.target;n.dataset.src&&(n.src=n.dataset.src,n.removeAttribute("data-src"),n.classList.remove("lazy"),e.unobserve(n))}})}),t=document.querySelectorAll("img[data-src]");t.forEach(function(t){e.observe(t)})}}function initMobileTocToggle(){const e=document.querySelector(".toc-toggle-btn"),t=document.querySelector(".mobile-toc");e&&t&&e.addEventListener("click",function(){t.classList.toggle("active");const n=t.classList.contains("active"),s=e.querySelector("svg");n?e.innerHTML=`
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                    隱藏目錄
                `:e.innerHTML=`
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M3 9h14V7H3v2zm0 4h14v-2H3v2zm0 4h14v-2H3v2zm16 0h2v-2h-2v2zm0-10v2h2V7h-2zm0 6h2v-2h-2v2z"/>
                    </svg>
                    目錄
                `})}function initThemeToggle(){}function debounce(e,t){let n;return function(...s){const o=function(){clearTimeout(n),e(...s)};clearTimeout(n),n=setTimeout(o,t)}}function initTocActiveTracking(){const t=document.querySelectorAll('.desktop-toc a[href^="#"], .mobile-toc a[href^="#"]'),e=document.querySelectorAll(".post-content h2[id], .post-content h3[id], .post-content h4[id], .post-content h5[id], .post-content h6[id]");if(t.length===0||e.length===0){console.log("TOC tracking: No links or headings found");return}console.log("TOC tracking initialized with",t.length,"links and",e.length,"headings");const n=debounce(function(){const s=window.pageYOffset,a=window.innerHeight,i=70,o=s+i+100;let n=null;for(let t=0;t<e.length;t++){const s=e[t],a=s.offsetTop,i=e[t+1],r=i?i.offsetTop:document.body.scrollHeight;if(o>=a&&o<r){n=s;break}}if(!n&&s<e[0].offsetTop&&(n=e[0]),!n&&s>=e[e.length-1].offsetTop&&(n=e[e.length-1]),t.forEach(e=>{e.classList.remove("active"),e.style.fontWeight=""}),n){const e=n.id;console.log("Active heading:",e);const t=document.querySelectorAll(`a[href="#${e}"]`);t.forEach(e=>{if(e.closest(".toc")){e.classList.add("active"),e.style.fontWeight="600";const t=e.closest(".desktop-toc");if(t&&window.innerWidth>1024){const n=t.getBoundingClientRect(),s=e.getBoundingClientRect();if(s.top<n.top+20||s.bottom>n.bottom-20){const n=e.offsetTop-t.offsetTop-t.clientHeight/2;t.scrollTo({top:n,behavior:"smooth"})}}}})}},50);n(),window.addEventListener("scroll",n),window.addEventListener("resize",debounce(n,200))}function initReadingProgress(){const e=document.querySelector(".reading-progress");if(!e)return;const t=debounce(function(){const t=document.querySelector(".post-content");if(!t)return;const n=t.offsetTop,s=t.offsetHeight,o=window.pageYOffset,i=window.innerHeight,a=Math.min(Math.max((o-n+i)/s,0),1);e.style.width=`${a*100}%`},100);window.addEventListener("scroll",t),t()}function initLanguageTags(){const e=document.querySelectorAll(".highlight code[data-lang]");e.forEach(function(e){const n=e.closest(".highlight"),t=e.getAttribute("data-lang");n&&t&&(n.setAttribute("data-lang",t),console.log("Language tag set:",t,"for highlight container"))})}